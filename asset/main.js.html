<script>
  var baseUrl = "https://script.google.com/macros/s/AKfycbx5AL3495XgTzr50RXx3gDt35MaTEYxGxQmgOkyMiw1/dev";

  $(document).ready(function(){
    google.script.run.withSuccessHandler(providePageTitle).getPageTitle();
    google.script.run.withSuccessHandler(provideComboBox).getAllTypes();
    google.script.run.withSuccessHandler(provideLibList).getAllLibraries();
    $("#createLib").click(function(event) {
      event.preventDefault();
      let name = $("#repoName").val();
      let type = $("#typeCombo").val();
      let description = $("#description").val();
      if(name != "" && name != null && name != undefined) {
        google.script.run.withSuccessHandler(function() {
          window.top.location = baseUrl;
        }).createLibrary(name, type, description);
      }
    });
  });

  function provideComboBox(types) {
    types.forEach(function(type) {
      $("#typeCombo").append(new Option(type, type));
    });
  }

  function providePageTitle(pageTitle) {
    $("#pageTitle").text(pageTitle);
  }

  function deleteLib(uniqueName) {
    google.script.run.withSuccessHandler(function() {
      window.top.location = baseUrl;
    }).deleteLibrary(uniqueName)
  }

  function provideLibList(vals) {
    $("#libBody").empty();
    if(vals == null) {
      $("#libPlaceholder").toggleClass('d-none');
    } else {
      console.log(vals['libraries']);
      $("#libTable").toggleClass("d-none");
      vals['libraries'].forEach(function(val) {
        var currentDate = new Date(val["timestamp"]);
        $("#libBody").append('<tr><th scope="row"><a href="' + baseUrl + "?page=currentLib&pageTitle=" + val["name"] + "&id=" + val["uniqueName"] + '">' + val["name"] + '</a></th><td>' + val["type"] + '</td><td>' + val["desc"] + '</td><td>' + currentDate.toGMTString() + '</td><td><i class="bi bi-pencil-fill me-3"></i><i class="bi bi-trash-fill cursor-hover" onClick=deleteLib("' + val["uniqueName"] + '")></i></td></tr>');
      });
    }
  }
</script>